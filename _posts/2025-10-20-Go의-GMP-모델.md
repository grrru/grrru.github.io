---
title: Go의 GMP 모델
date: 2025-10-20 19:24 +0900
categories:
  - golang
tags:
  - GMP
pin: false
---

좋은 질문입니다! Go의 **논리 프로세서(P, Processor)**와 **고루틴(G, Goroutine)**은 완전히 다른 개념입니다. Go의 스케줄러 모델을 이해하는 핵심 질문이에요!

## Go의 GMP 모델

Go 런타임은 3가지 주요 구성 요소로 이루어져 있습니다:

```
G (Goroutine) - 고루틴
M (Machine)   - OS 스레드
P (Processor) - 논리 프로세서 (스케줄링 컨텍스트)
```

### 관계도

```
┌─────────────────────────────────────┐
│         Go 프로그램                  │
├─────────────────────────────────────┤
│                                     │
│  G1  G2  G3  G4  G5  G6  G7  G8    │  ← 수천~수만 개의 고루틴
│   ↓   ↓   ↓   ↓   ↓   ↓   ↓   ↓    │
│  ┌───┐ ┌───┐ ┌───┐ ┌───┐          │
│  │ P0│ │ P1│ │ P2│ │ P3│          │  ← GOMAXPROCS (보통 CPU 코어 수)
│  └─┬─┘ └─┬─┘ └─┬─┘ └─┬─┘          │
│    │     │     │     │             │
│  ┌─▼─┐ ┌─▼─┐ ┌─▼─┐ ┌─▼─┐          │
│  │M0 │ │M1 │ │M2 │ │M3 │          │  ← OS 스레드
│  └───┘ └───┘ └───┘ └───┘          │
└─────────────────────────────────────┘
         ↓     ↓     ↓     ↓
    ┌─────────────────────────┐
    │    CPU 코어 (물리)       │
    │   Core0 Core1 Core2...  │
    └─────────────────────────┘
```

## 각 요소 설명

### G (Goroutine) - 고루틴
- **개수**: 수천~수만 개 (제한 거의 없음)
- **크기**: 스택 2KB부터 시작 (매우 가벼움)
- **역할**: 실제 실행될 작업/함수
- **상태**: Runnable, Running, Waiting 등

```go
go func() {  // ← 새로운 G 생성
    fmt.Println("Hello")
}()
```

### P (Processor) - 논리 프로세서
- **개수**: `GOMAXPROCS` (기본값: CPU 코어 수)
- **역할**: 
  - 고루틴 스케줄링 컨텍스트
  - 실행 가능한 고루틴 큐(Local Run Queue) 관리
  - 리소스(메모리 캐시 등) 보유
- **중요**: 실제로 실행하지는 않음! 스케줄링만!

```go
runtime.GOMAXPROCS(4)  // P를 4개로 설정
```

### M (Machine) - OS 스레드
- **개수**: 필요에 따라 동적으로 생성/제거 (보통 P 개수와 비슷)
- **역할**: 실제로 CPU에서 코드를 실행하는 OS 스레드
- **관계**: M이 P에 연결되어야 고루틴 실행 가능

## 실제 동작 방식

### 1. 정상 실행

```
P0에 연결된 M0가 G1을 실행:

P0 [G1, G2, G3]  ←─ Local Run Queue (실행 대기 중인 고루틴들)
 ↓
M0 (OS Thread)
 ↓
G1 실행 중...
```

### 2. 여러 P가 동시에 동작

```
4코어 CPU, GOMAXPROCS=4:

시간 T:
P0 → M0 → G1 실행    | CPU Core 0
P1 → M1 → G5 실행    | CPU Core 1
P2 → M2 → G9 실행    | CPU Core 2
P3 → M3 → G13 실행   | CPU Core 3

P0의 대기열: [G2, G3, G4]
P1의 대기열: [G6, G7, G8]
P2의 대기열: [G10, G11, G12]
P3의 대기열: [G14, G15, G16]
```

### 3. 시스템 콜이나 블로킹 발생 시

```
G1이 시스템 콜(파일 I/O 등)을 하면:

Before:
P0 → M0 → G1 (실행 중)

After:
P0 → M1 → G2 (다른 고루틴 실행)  ← 새 M 연결
     
M0 → G1 (시스템 콜 대기)         ← P에서 분리됨

G1 완료 후:
M0는 다시 P를 찾거나, 쉬거나, 종료됨
```
